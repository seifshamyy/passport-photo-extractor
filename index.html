<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passport Photo Cropper</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; background: #f4f4f9; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        .drop-zone { border: 2px dashed #ccc; padding: 2rem; text-align: center; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .drop-zone:hover, .drop-zone.dragover { border-color: #007bff; background: #eef7ff; }
        input[type="file"] { display: none; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; margin-top: 1rem; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .result-area { display: flex; gap: 20px; margin-top: 2rem; justify-content: center; flex-wrap: wrap; }
        .img-box { text-align: center; }
        img { max-width: 100%; max-height: 300px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border: 1px solid #ddd; }
        .label { display: block; margin-bottom: 0.5rem; font-weight: bold; color: #555; }
        #status { text-align: center; margin-top: 1rem; height: 1.5rem; color: #d9534f; }
    </style>
</head>
<body>

<div class="container">
    <h1>Passport Photo Cropper</h1>
    
    <div class="drop-zone" id="dropZone">
        <p>Drag & Drop passport/ID photo here or click to upload</p>
        <input type="file" id="fileInput" accept="image/*">
    </div>
    <div style="text-align: center;">
        <button id="processBtn" class="btn" disabled>Process Photo</button>
    </div>

    <div id="status"></div>

    <div class="result-area" id="resultArea" style="display: none;">
        <div class="img-box">
            <span class="label">Original</span>
            <img id="originalImg" src="">
        </div>
        <div class="img-box">
            <span class="label">Passport Crop</span>
            <img id="processedImg" src="">
        </div>
    </div>
</div>

<script>
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const processBtn = document.getElementById('processBtn');
    const statusDiv = document.getElementById('status');
    const resultArea = document.getElementById('resultArea');
    const originalImg = document.getElementById('originalImg');
    const processedImg = document.getElementById('processedImg');
    
    let currentFile = null;

    // Drag & Drop Handlers
    dropZone.addEventListener('click', () => fileInput.click());
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        handleFile(e.dataTransfer.files[0]);
    });
    fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

    function handleFile(file) {
        if (!file || !file.type.startsWith('image/')) return;
        currentFile = file;
        
        // Preview Original
        const reader = new FileReader();
        reader.onload = (e) => {
            originalImg.src = e.target.result;
            resultArea.style.display = 'flex';
            processedImg.src = ''; // Clear previous
            processBtn.disabled = false;
            statusDiv.textContent = '';
        };
        reader.readAsDataURL(file);
    }

    processBtn.addEventListener('click', async () => {
        if (!currentFile) return;

        processBtn.disabled = true;
        processBtn.textContent = 'Processing...';
        statusDiv.textContent = '';
        processedImg.style.opacity = '0.5';

        const formData = new FormData();
        formData.append('photo', currentFile);

        try {
            // Requesting Base64 mode for easy frontend handling, 
            // but you can remove ?format=base64 to get binary Blob
            const response = await fetch('/api/crop?format=base64', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.error || 'Failed to process');
            }

            const data = await response.json();
            processedImg.src = data.image;
            statusDiv.style.color = '#28a745';
            statusDiv.textContent = 'Success! Face detected and cropped.';

        } catch (error) {
            statusDiv.style.color = '#d9534f';
            statusDiv.textContent = error.message;
        } finally {
            processBtn.disabled = false;
            processBtn.textContent = 'Process Photo';
            processedImg.style.opacity = '1';
        }
    });
</script>

</body>
</html>
